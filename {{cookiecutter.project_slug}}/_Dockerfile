FROM rocker/tidyverse:4.1.3

RUN apt-get update && \
    apt-get install -y --no-install-recommends \
    curl \
    python3.9 \
    pandoc \
    pandoc-citeproc \
    gdebi-core \
    r-base \
    zip \
    && curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip" \
    && unzip awscliv2.zip \
    && ./aws/install \
    && rm -rf /var/lib/apt/lists/*

RUN install2.r \
    knitr \
    rmarkdown \
    quarto

RUN curl -LO https://quarto.org/download/latest/quarto-linux-amd64.deb

RUN gdebi --non-interactive quarto-linux-amd64.deb

RUN quarto check

WORKDIR /app

COPY [ \
    "requirements.txt", \
    "./"]

RUN curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
RUN python3.9 get-pip.py
RUN python3.9 -m pip install -r requirements.txt

ENV PATH="${PATH}:/root/.local/bin"

COPY . .

CMD /bin/sh
